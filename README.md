
## Данный репозиторий предназначен для запуска двух сервисов на Django

### 1. Первый сервис (Producer)
#### 1.1 Функциональность
- **1.1.1 Прием чеков покупок с клиентов:** Этот сервис отвечает за прием чеков покупок, которые поступают от клиентов.
- **1.1.2 Валидация чеков:** Проводится проверка чеков на корректность формата и соответствие ожидаемой структуре перед их обработкой.
- **1.1.3 Запись в журнал всех полученных чеков:** Все полученные чеки записываются в журнал для последующей обработки и анализа.
- **1.1.4 Отправка чеков второму сервису посредством Apache Kafka:** После валидации чеки отправляются второму сервису для дальнейшей обработки и анализа с использованием Apache Kafka

### 2. Второй сервис (Consumer)
#### 2.1 Функциональность
- **2.1.1 Прием чеков из первого сервиса посредством Apache Kafka:** Этот сервис принимает чеки, отправленные первым сервисом, с использованием Apache Kafka.
- **2.1.2 Разбиение содержимого чеков на привязку к местам покупок и дополнительной информации:** Содержимое чеков анализируется и разбивается на категории, такие как места покупок и другая дополнительная информация.
- **2.1.3 Сохранение данных в БД:** Обработанные данные сохраняются в базе данных для последующего доступа и анализа.
- **2.1.4 Расчет аналитики:**
  - Количество покупок в каждом месте.
  - Средний чек в каждом месте.
  - Общая сумма налогов и чаевых за промежуток времени.
  - Аналитика по категориям товаров.
- **2.1.5 Запуск расчетов аналитики каждый час с использованием Celery:** Для автоматизации процесса анализа данные будут обрабатываться каждый час с использованием Celery.

### Инструкции по запуску обоих сервисов:
1. Склонировать репозиторий:
git clone https://github.com/Ivan-k35/DjangoServices.git

2. Перейти в каталог проекта:
cd DjangoServices

3. Запустить оба сервиса:
docker-compose up -d

Примечание: В случае ошибки соединения с базой данных при первом запуске, выполните следующие команды:

1. Остановите сервисы этой командой: docker-compose down 
2. Заново запустите: docker-compose up -d

Документация Swagger доступна по следующим адресам:
- Для первого сервиса: [http://127.0.0.1/api/producer/swagger/](http://127.0.0.1/api/producer/swagger/)
- Для второго сервиса: [http://127.0.0.1/api/consumer/swagger/](http://127.0.0.1/api/consumer/swagger/)

Аналитика данных запускается каждый час.

Вот список реализованных эндпоинтов:

- [http://127.0.0.1/api/producer/checks/](http://127.0.0.1/api/producer/checks/) - эндпоинт для передачи данных о чеке покупки первому сервису.
- [http://127.0.0.1/api/consumer/places/](http://127.0.0.1/api/consumer/places/) - эндпоинт для получения данных о местах покупок от второго сервиса.
- [http://127.0.0.1/api/consumer/analytics/](http://127.0.0.1/api/consumer/analytics/) - эндпоинт для получения аналитики данных от второго сервиса.


Пример данных о покупке чека для передачи первому сервису по адресу по адресу http://127.0.0.1/api/producer/checks/ :

```json
{
  "transaction_id": "unique_transaction_id297",
  "timestamp": "2024-02-07T12:34:56",
  "place_id": "unique_place_id1",
  "place_name": "Store ABCE",
  "items": [
    {
      "product_id": "product_id_1",
      "quantity": 2,
      "price": 10.99,
      "category": "groceries"
    },
    {
      "product_id": "product_id_2",
      "quantity": 1,
      "price": 5.49,
      "category": "electronics"
    }
  ],
  "total_amount": 27.47,
  "nds_amount": 2.47,
  "tips_amount": 3.0,
  "payment_method": "credit_card"
}
